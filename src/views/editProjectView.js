import ModalView from './modalView';

class EditProjectView extends ModalView {
  _parentElement = document.querySelector('.modal--task-details');
  _window = document.querySelector('.modal--task-details');
  _title = document.querySelector('.task-display--project-title');

  _btnClose = document.querySelector('.icon--close-editor-modal');
  _btnSubmit = document.querySelector('.task-editor--icon-wrapper.task-save');
  _btnDelete = document.querySelector('.task-editor--icon-wrapper.task-delete');

  constructor() {
    super();
  }

  _generateMarkup() {
    const markup = `
        <span class="material-icons icon--close-editor-modal"> close </span>
        <input
          class="project-editor--form-element project-editor--project-title"
          type="text"
          placeholder="Sample Title"
          value="${this._data.title}"
          minlength="1"
          maxlength="60"
        />

        <div class="project-editor--project-editor-wrapper">
          <div class="project-editor--icon-wrapper project-save">Save</div>
          <div class="project-editor--icon-wrapper project-delete">Delete</div>
        </div> 
    `;

    this._parentElement.classList.add('modal--project-editor');

    this._parentElement.dataset.id = this._data.title;

    return markup;
  }

  _generatePlaceholder() {
    console.log('edit project view');

    const markup = `
        <span class="material-icons icon--close-editor-modal"> close </span>
        <input
          class="project-editor--form-element project-editor--project-title"
          type="text"
          placeholder="Example Project Title"
          value="Example Project"
          minlength="1"
          maxlength="60"
        />

        <div class="project-editor--project-editor-wrapper">
          <div class="project-editor--icon-wrapper project-save">Save</div>
          
        </div> 
    `;

    this._parentElement.classList.add('modal--project-editor');

    this._clear();
    this._parentElement.insertAdjacentHTML('afterbegin', markup);
    // return markup;
  }

  _validateTask(title) {
    if (!title) {
      return false;
    } else return true;
  }

  _renderFormError() {
    console.log('form error');
  }

  _showEditorModal(handler, e) {
    const id = document.querySelector(
      '.task-display--project-title'
    ).textContent;

    this.toggleWindow();

    handler(id);

    this._btnClose = document.querySelector('.icon--close-editor-modal');
    this._addHandlerCloseModal();
  }

  addHandlerShowEditor(handler) {
    document
      .querySelector('.task-display--project-btn-edit')
      .addEventListener('click', this._showEditorModal.bind(this, handler));
  }

  _saveEdit(handler, e) {
    const projectTitle = this._parentElement.querySelector(
      '.project-editor--project-title'
    ).value;

    if (this._validateTask(projectTitle)) {
      const data = {
        title: projectTitle,
      };

      this.toggleWindow();
      handler(this._parentElement.dataset.id, data);
    } else {
      this._renderFormError();
    }
  }

  addHandlerSaveEdit(handler) {
    document
      .querySelector('.project-editor--icon-wrapper.project-save')
      .addEventListener('click', this._saveEdit.bind(this, handler));
  }

  _deleteProjectOnModal(handler, e) {
    // const id = this._title;
    const id = document.querySelector(
      '.task-display--project-title'
    ).textContent;

    handler(id);
  }

  addHandlerDeleteProjectOnModal(handler) {
    document
      .querySelector('.project-editor--icon-wrapper.project-delete')
      .addEventListener(
        'click',
        this._deleteProjectOnModal.bind(this, handler)
      );
  }
}

export default new EditProjectView();
